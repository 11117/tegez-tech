<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TEGEZ Ifi technikusi beoszt√°s</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eceff1; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #263238; }
        #status { text-align: center; padding: 10px; font-weight: bold; color: #0288d1; }
        .table-wrapper { max-height: 70vh; overflow-y: auto; border: 1px solid #cfd8dc; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #455a64; color: white; padding: 12px; position: sticky; top: 0; z-index: 10; font-size: 13px; }
        td { border: 1px solid #eceff1; padding: 8px; vertical-align: top; }
        .szombat { background: #fff9c4 !important; border-left: 5px solid #fbc02d; }
        .vasarnap { background: #fafafa; color: #c62828; }
        .today-highlight { outline: 4px solid #ff9800; background-color: #fff3e0 !important; }
        input { width: 90%; padding: 6px; margin-bottom: 4px; border: 1px solid #cfd8dc; border-radius: 4px; }
        .label { font-size: 10px; color: #78909c; font-weight: bold; display: block; }
        .auto-btn { background: #0288d1; color: white; border: none; padding: 8px; cursor: pointer; border-radius: 4px; width: 100%; font-weight: bold; margin-bottom: 5px; }
        .save-btn { background: #43a047; color: white; border: none; padding: 10px; cursor: pointer; width: 100%; border-radius: 6px; font-weight: bold; transition: background 0.3s; }
        .top-nav { display: flex; justify-content: flex-end; margin-bottom: 10px; }
        .today-btn { background: #ff9800; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; }
		
/* --- ALAPOK --- */
html, body {
    width: 100%;
    margin: 0;
    padding: 0;
    background-color: #f5f7fa;
}

.container {
    width: 95%;
    max-width: 1200px;
    margin: 20px auto;
    padding: 20px;
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

/* T√°bl√°zat t√°rol√≥ a mobil g√∂rget√©shez, de csak v√©gsz√ºks√©g eset√©n */
.table-wrapper {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

table {
    width: 100%;
    border-collapse: collapse;
    table-layout: auto; /* Hagyjuk a tartalomhoz igazodni */
}

/* --- OSZLOPOK PONTOS√çT√ÅSA --- */
.col-date, .col-save {
    width: 1%;
    white-space: nowrap;
    padding: 12px 8px;
}

/* Technikus oszlopok: ne engedj√ºk ≈ëket 140px al√° esni mobilon sem */
.col-tech {
    min-width: 140px; 
    padding: 12px 8px;
    vertical-align: top;
}

.col-comment {
    min-width: 180px; /* Hogy a megjegyz√©s is olvashat√≥ maradjon */
    padding: 12px 8px;
}

/* --- ELEMEK ST√çLUSA --- */
.label {
    font-size: 11px;
    color: #8e9aaf;
    display: block;
    margin-bottom: 2px;
    font-weight: 600;
}

input, textarea {
    width: 100%;
    box-sizing: border-box;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    padding: 8px;
    font-size: 14px;
}

/* Eredeti z√∂ld gomb */
.save-btn {
    background-color: #5cb85c;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
}

/* --- MOBIL SPECIFIKUS JAV√çT√ÅSOK --- */
@media screen and (max-width: 768px) {
    .container {
        width: 100%;
        padding: 5px;
        margin: 0;
        border-radius: 0;
    }

    /* Mobilon picit kisebb padding, hogy t√∂bb f√©rjen el */
    .col-tech, .col-comment, .col-date, .col-save {
        padding: 8px 4px;
    }

    /* Itt a tr√ºkk: a vet√≠t≈ës√∂knek adunk egy kis extra fix helyet, hogy ne ugorjanak √∂ssze */
    .col-tech {
        min-width: 130px;
    }

    input, textarea {
        font-size: 16px !important; /* Tiltja a mobil zoomot */
        padding: 10px 5px;
    }
}
		
    </style>
</head>
<body>
<div class="container">
    <h2>üìÖ Szolg√°lati Beoszt√°s</h2>
    <div id="status">Szinkroniz√°l√°s... K√©rlek v√°rj!</div>
    <div class="top-nav"><button class="today-btn" onclick="scrollToToday()">üìç Ugr√°s a mai naphoz</button></div>
    <div class="table-wrapper">
        <table>
            <thead><tr><th>D√°tum</th><th>Hangtechnikusok</th><th>Vet√≠t≈ës√∂k</th><th>Megjegyz√©s <br> <small>("XY: nem tudok j√∂nni", <br> k√ºl√∂nleges alkalom, stb.)</small> </th><th> Ment√©s <br><small></small></th></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyts0pt7s1ReKvRhtjAmWhcqwqjL5MNaOgObhhQRjmwxnZ1xgwjYNlNBLWusLaXLiRy/exec';

    async function init() {
        generateCalendar();
        await loadData();
        setTimeout(scrollToToday, 500);
    }

    function generateCalendar() {
    const tbody = document.getElementById('tableBody');
    const ma = new Date();
    let html = "";
    for (let i = 0; i < 180; i++) {
        let d = new Date(); d.setDate(ma.getDate() + i);
        let iso = d.toISOString().split('T')[0];
        let nap = d.getDay();
        let cls = (nap === 6) ? "szombat" : (nap === 0 ? "vasarnap" : "");
        html += `<tr class="${cls}" id="row-${iso}">
            <td class="col-date"><strong>${d.toLocaleDateString('hu-HU',{month:'short',day:'numeric'})}</strong><br><small>${d.toLocaleDateString('hu-HU',{weekday:'long'})}</small></td>
            <td class="col-tech">
                ${nap===6?`<div class="auto-wrapper"><button class="auto-btn" id="ah-${iso}" onclick="autoFill('${iso}','hang')">‚ú® Auto</button></div>`:''}
                <div class="input-wrapper"><span class="label">F≈ë:</span><input id="h1-${iso}"></div>
                <div class="input-wrapper"><span class="label">Tartal√©kos:</span><input id="h2-${iso}"></div>
            </td>
            <td class="col-tech">
                ${nap===6?`<div class="auto-wrapper"><button class="auto-btn" id="av-${iso}" onclick="autoFill('${iso}','vetito')">‚ú® Auto</button></div>`:''}
                <div class="input-wrapper"><span class="label">F≈ë:</span><input id="v1-${iso}"></div>
                <div class="input-wrapper"><span class="label">Tartal√©kos:</span><input id="v2-${iso}"></div>
            </td>
            <td class="col-comment">
                <textarea id="m-${iso}" placeholder="Megjegyz√©s..." oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"></textarea>
            </td>
            <td class="col-save">
                <button class="save-btn" id="s-${iso}" onclick="saveRow('${iso}')">Ment√©s</button>
            </td>
        </tr>`;
    }
    tbody.innerHTML = html;
}

    async function loadData() {
        try {
            const res = await fetch(scriptURL);
            const data = await res.json();
            data.forEach((row, idx) => {
                if (idx === 0) return;
                let d = row[0];
                if(document.getElementById(`h1-${d}`)) {
                    document.getElementById(`h1-${d}`).value = row[1]||""; document.getElementById(`h2-${d}`).value = row[2]||"";
                    document.getElementById(`v1-${d}`).value = row[3]||""; document.getElementById(`v2-${d}`).value = row[4]||"";
                    document.getElementById(`m-${d}`).value = row[5]||"";
                }
            });
            document.getElementById('status').innerText = "‚úÖ Adatok bet√∂ltve.";
        } catch(e) { document.getElementById('status').innerText = "‚ö†Ô∏è Hiba a bet√∂lt√©sn√©l."; }
    }

    async function autoFill(iso, tipus) {
        const btn = document.getElementById(tipus === 'hang' ? `ah-${iso}` : `av-${iso}`);
        btn.innerText = "‚è≥..."; btn.disabled = true;
        try {
            const res = await fetch(scriptURL + "?action=getAutoBeosztas");
            const data = await res.json();
            let lista = (tipus === 'hang') ? (data.hangLista || []) : (data.vetitoLista || []);
            let busy = [document.getElementById(`h1-${iso}`).value, document.getElementById(`h2-${iso}`).value, 
                        document.getElementById(`v1-${iso}`).value, document.getElementById(`v2-${iso}`).value].filter(n => n);
            
            let talalt = [];
            for (let n of lista) { if(!busy.includes(n)) talalt.push(n); if(talalt.length === 2) break; }

            if(tipus === 'hang') {
                document.getElementById(`h1-${iso}`).value = talalt[0] || "";
                document.getElementById(`h2-${iso}`).value = talalt[1] || "";
            } else {
                document.getElementById(`v1-${iso}`).value = talalt[0] || "";
                document.getElementById(`v2-${iso}`).value = talalt[1] || "";
            }
        } catch(e) { alert("Hiba!"); }
        btn.innerText = "‚ú® Auto"; btn.disabled = false;
    }

    async function saveRow(iso) {
        const h1v = document.getElementById(`h1-${iso}`).value.trim();
        const h2v = document.getElementById(`h2-${iso}`).value.trim();
        const v1v = document.getElementById(`v1-${iso}`).value.trim();
        const v2v = document.getElementById(`v2-${iso}`).value.trim();
        const n = [h1v, h2v, v1v, v2v].filter(x => x!=="");
        
        if(new Set(n).size !== n.length) { alert("‚ùå Hiba: Egy n√©v csak egyszer szerepelhet!"); return; }
        
        const btn = document.getElementById(`s-${iso}`);
        btn.innerText = "‚è≥ Ment√©s...";
        btn.disabled = true;
        btn.style.background = "#90a4ae"; // Sz√ºrk√©re v√°lt ment√©skor

        const payload = { datum: iso, h1: h1v, h2: h2v, v1: v1v, v2: v2v, m: document.getElementById(`m-${iso}`).value };
        
        try {
            await fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
            btn.innerText = "‚úÖ K√âSZ - Mentsd m√©gegyszer!";
            btn.style.background = "#43a047";
            setTimeout(() => { btn.innerText = "Ment√©s"; btn.disabled = false; }, 2500);
        } catch(e) { 
            alert("Hiba!"); 
            btn.innerText = "Ment√©s"; 
            btn.disabled = false; 
            btn.style.background = "#43a047";
        }
    }

    function scrollToToday() {
        const d = new Date().toISOString().split('T')[0];
        const r = document.getElementById(`row-${d}`);
        if(r) { r.classList.add('today-highlight'); r.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
    }
    window.onload = init;
</script>
</body>
</html>